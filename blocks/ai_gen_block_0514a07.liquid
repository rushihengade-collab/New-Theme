{% doc %}
  @prompt
    Make Slideshow Section, all slide will combine icon placed at the centre, make the slideshow image size is large to screen, don't give icon option for all slides separately, there will be one icon only which will be used for all the slides, don't use navigation arrow, give the option to upload the icon image, don't give heading and text, instead use that space for the icon image, don't use Star as an icon, icon will be the one which is custom image icon, make the slideshow transparent with the header, increase the icon size from 80 to 300 to 80 to 400, make the slideshow section transparent with the header, make the slideshow image transparent with the header, make the slideshow images trasparent with the header, make the section transparent with the header, the section is transparent with the header, make it transparent , make the section transparent with the above section, give the option to enable that, Allow transparent header as the section is first one, it is not overlapping, transparent with the header is not enabled
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-slideshow-{{ ai_gen_id }} {
    display: block;
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    {% if block.settings.enable_transparent_header %}
      margin-top: -120px;
      padding-top: 120px;
    {% endif %}
  }

  .ai-slideshow-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .ai-slideshow-slide-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity {{ block.settings.transition_speed }}s ease-in-out;
    pointer-events: none;
  }

  .ai-slideshow-slide-{{ ai_gen_id }}.active {
    opacity: 1;
    pointer-events: auto;
  }

  .ai-slideshow-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .ai-slideshow-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-slideshow-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 500px;
    max-height: 500px;
  }

  .ai-slideshow-overlay-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, {{ block.settings.overlay_opacity }});
    z-index: 1;
  }

  .ai-slideshow-content-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    width: 90%;
    max-width: 600px;
  }

  .ai-slideshow-icon-{{ ai_gen_id }} {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-slideshow-icon-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .ai-slideshow-icon-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.1);
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 14px;
  }

  .ai-slideshow-button-{{ ai_gen_id }} {
    display: inline-block;
    padding: 15px 40px;
    background-color: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    transition: all 0.3s ease;
    font-size: 16px;
  }

  .ai-slideshow-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_background }};
    color: {{ block.settings.button_hover_text_color }};
  }

  .ai-slideshow-dots-{{ ai_gen_id }} {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 3;
    display: flex;
    gap: 12px;
  }

  .ai-slideshow-dot-{{ ai_gen_id }} {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: {{ block.settings.dot_color }};
    opacity: 0.5;
    cursor: pointer;
    border: none;
    padding: 0;
    transition: all 0.3s ease;
  }

  .ai-slideshow-dot-{{ ai_gen_id }}.active {
    opacity: 1;
    transform: scale(1.2);
  }

  @media screen and (max-width: 749px) {
    .ai-slideshow-{{ ai_gen_id }} {
      height: 70vh;
      {% if block.settings.enable_transparent_header %}
        margin-top: -80px;
        padding-top: 80px;
      {% endif %}
    }

    .ai-slideshow-icon-{{ ai_gen_id }} {
      width: {{ block.settings.icon_size | times: 0.7 }}px;
      height: {{ block.settings.icon_size | times: 0.7 }}px;
    }
  }
{% endstyle %}

<slideshow-component-{{ ai_gen_id }} class="ai-slideshow-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-slideshow-container-{{ ai_gen_id }}">
    {% for i in (1..5) %}
      {% liquid
        assign slide_enabled_key = 'slide_' | append: i | append: '_enabled'
        assign slide_image_key = 'slide_' | append: i | append: '_image'
        assign slide_button_text_key = 'slide_' | append: i | append: '_button_text'
        assign slide_button_link_key = 'slide_' | append: i | append: '_button_link'

        assign slide_enabled = block.settings[slide_enabled_key]
        assign slide_image = block.settings[slide_image_key]
        assign slide_button_text = block.settings[slide_button_text_key]
        assign slide_button_link = block.settings[slide_button_link_key]
      %}

      {% if slide_enabled %}
        <div class="ai-slideshow-slide-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index }}">
          {% if slide_image %}
            <img
              src="{{ slide_image | image_url: width: 2000 }}"
              srcset="{{ slide_image | image_url: width: 1000 }} 1000w,
                      {{ slide_image | image_url: width: 1500 }} 1500w,
                      {{ slide_image | image_url: width: 2000 }} 2000w"
              sizes="100vw"
              alt="{{ slide_image.alt | escape }}"
              loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
              class="ai-slideshow-image-{{ ai_gen_id }}"
            >
          {% else %}
            <div class="ai-slideshow-placeholder-{{ ai_gen_id }}">
              {{ 'hero-apparel-1' | placeholder_svg_tag }}
            </div>
          {% endif %}

          <div class="ai-slideshow-overlay-{{ ai_gen_id }}"></div>

          <div class="ai-slideshow-content-{{ ai_gen_id }}">
            <div class="ai-slideshow-icon-{{ ai_gen_id }}">
              {% if block.settings.icon_image %}
                <img
                  src="{{ block.settings.icon_image | image_url: width: 500 }}"
                  alt="{{ block.settings.icon_image.alt | escape }}"
                  loading="lazy"
                >
              {% else %}
                <div class="ai-slideshow-icon-placeholder-{{ ai_gen_id }}">
                  Add icon
                </div>
              {% endif %}
            </div>

            {% if slide_button_text != blank and slide_button_link != blank %}
              <a href="{{ slide_button_link }}" class="ai-slideshow-button-{{ ai_gen_id }}">
                {{ slide_button_text }}
              </a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {% if block.settings.show_dots %}
    <div class="ai-slideshow-dots-{{ ai_gen_id }}">
      {% for i in (1..5) %}
        {% liquid
          assign slide_enabled_key = 'slide_' | append: i | append: '_enabled'
          assign slide_enabled = block.settings[slide_enabled_key]
        %}
        {% if slide_enabled %}
          <button class="ai-slideshow-dot-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index }}" aria-label="Go to slide {{ forloop.index }}"></button>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
</slideshow-component-{{ ai_gen_id }}>

<script>
  (function() {
    class SlideshowComponent{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentSlide = 0;
        this.slides = [];
        this.autoplayInterval = null;
      }

      connectedCallback() {
        this.slides = Array.from(this.querySelectorAll('.ai-slideshow-slide-{{ ai_gen_id }}'));
        this.dots = Array.from(this.querySelectorAll('.ai-slideshow-dot-{{ ai_gen_id }}'));

        this.setupEventListeners();
        
        {% if block.settings.autoplay %}
          this.startAutoplay();
        {% endif %}
      }

      setupEventListeners() {
        this.dots.forEach((dot, index) => {
          dot.addEventListener('click', () => this.goToSlide(index));
        });

        this.addEventListener('mouseenter', () => this.stopAutoplay());
        this.addEventListener('mouseleave', () => {
          {% if block.settings.autoplay %}
            this.startAutoplay();
          {% endif %}
        });
      }

      goToSlide(index) {
        this.slides[this.currentSlide].classList.remove('active');
        if (this.dots[this.currentSlide]) {
          this.dots[this.currentSlide].classList.remove('active');
        }

        this.currentSlide = index;

        this.slides[this.currentSlide].classList.add('active');
        if (this.dots[this.currentSlide]) {
          this.dots[this.currentSlide].classList.add('active');
        }
      }

      nextSlide() {
        const nextIndex = (this.currentSlide + 1) % this.slides.length;
        this.goToSlide(nextIndex);
      }

      startAutoplay() {
        this.stopAutoplay();
        this.autoplayInterval = setInterval(() => {
          this.nextSlide();
        }, {{ block.settings.autoplay_speed | times: 1000 }});
      }

      stopAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }

      disconnectedCallback() {
        this.stopAutoplay();
      }
    }

    customElements.define('slideshow-component-{{ ai_gen_id }}', SlideshowComponent{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Slideshow",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header",
      "label": "Enable transparent header",
      "info": "When enabled, the slideshow will overlap with the header above it for a seamless full-screen experience. Use this when the slideshow is the first section on your page.",
      "default": true
    },
    {
      "type": "range",
      "id": "transition_speed",
      "label": "Transition speed",
      "min": 0.5,
      "max": 2,
      "step": 0.5,
      "unit": "s",
      "default": 1
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Image overlay opacity",
      "min": 0,
      "max": 0.8,
      "step": 0.1,
      "default": 0.3
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show navigation dots",
      "default": true
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Icon"
    },
    {
      "type": "image_picker",
      "id": "icon_image",
      "label": "Icon image"
    },
    {
      "type": "range",
      "id": "icon_size",
      "label": "Icon size",
      "min": 80,
      "max": 400,
      "step": 20,
      "unit": "px",
      "default": 200
    },
    {
      "type": "header",
      "content": "Button style"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Hover background",
      "default": "#5c5c5c"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Hover text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "Slide 1"
    },
    {
      "type": "checkbox",
      "id": "slide_1_enabled",
      "label": "Enable slide 1",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_1_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "slide_1_button_text",
      "label": "Button text",
      "default": "Shop now"
    },
    {
      "type": "url",
      "id": "slide_1_button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Slide 2"
    },
    {
      "type": "checkbox",
      "id": "slide_2_enabled",
      "label": "Enable slide 2",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_2_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "slide_2_button_text",
      "label": "Button text",
      "default": "Explore"
    },
    {
      "type": "url",
      "id": "slide_2_button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Slide 3"
    },
    {
      "type": "checkbox",
      "id": "slide_3_enabled",
      "label": "Enable slide 3",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "slide_3_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "slide_3_button_text",
      "label": "Button text",
      "default": "View deals"
    },
    {
      "type": "url",
      "id": "slide_3_button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Slide 4"
    },
    {
      "type": "checkbox",
      "id": "slide_4_enabled",
      "label": "Enable slide 4",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "slide_4_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "slide_4_button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "slide_4_button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Slide 5"
    },
    {
      "type": "checkbox",
      "id": "slide_5_enabled",
      "label": "Enable slide 5",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "slide_5_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "slide_5_button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "slide_5_button_link",
      "label": "Button link"
    }
  ],
  "presets": [
    {
      "name": "Slideshow"
    }
  ]
}
{% endschema %}
